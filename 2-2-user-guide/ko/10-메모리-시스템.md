# 메모리 시스템

## 핵심 개념
메모리는 작업공간의 **일반 마크다운 파일**. 모델은 디스크에 쓰인 것만 "기억"함.

## 메모리 파일

| 파일 | 목적 | 로드 시기 |
|------|------|----------|
| `memory/YYYY-MM-DD.md` | 일일 로그 (추가 전용) | 세션 시작 시 오늘 + 어제 |
| `MEMORY.md` | 큐레이팅된 장기 메모리 | **메인 세션만** (그룹에서 절대 안 됨) |

위치: `~/.openclaw/workspace/` (또는 설정된 작업공간)

## 언제 쓸까
- 결정, 선호, 사실 → `MEMORY.md`
- 일상 메모 → `memory/YYYY-MM-DD.md`
- "이거 기억해" → 즉시 쓰기 (RAM에 두지 않음)

## 자동 메모리 플러시

컨텍스트 압축 전에 OpenClaw가 메모리 작성을 상기시키는 조용한 턴 실행.

```json5
{
  agents: {
    defaults: {
      compaction: {
        reserveTokensFloor: 20000,
        memoryFlush: {
          enabled: true,
          softThresholdTokens: 4000,
          systemPrompt: "세션이 곧 압축됩니다. 지속적인 메모리를 저장하세요.",
          prompt: "memory/YYYY-MM-DD.md에 메모 작성; 저장할 것 없으면 NO_REPLY 답변."
        }
      }
    }
  }
}
```

## 메모리 검색 도구

- `memory_search` - 메모리 파일에서 의미론적 검색
- `memory_get` - 경로로 특정 메모리 파일 읽기

## 벡터 검색 설정

```json5
{
  agents: {
    defaults: {
      memorySearch: {
        enabled: true,
        provider: "openai",  // openai | gemini | local
        model: "text-embedding-3-small",
        fallback: "openai"
      }
    }
  }
}
```

### 프로바이더 자동 선택
1. `local` - 모델 경로 설정된 경우
2. `openai` - API 키 있는 경우
3. `gemini` - API 키 있는 경우
4. 없으면 비활성화

## 하이브리드 검색 (BM25 + 벡터)

의미론적 유사성 + 키워드 관련성 결합:

```json5
{
  agents: {
    defaults: {
      memorySearch: {
        query: {
          hybrid: {
            enabled: true,
            vectorWeight: 0.7,
            textWeight: 0.3
          }
        }
      }
    }
  }
}
```

## 추가 메모리 경로

```json5
{
  agents: {
    defaults: {
      memorySearch: {
        extraPaths: ["../team-docs", "/srv/shared-notes/overview.md"]
      }
    }
  }
}
```

## 인덱스 저장
- SQLite: `~/.openclaw/memory/<agentId>.sqlite`
- 빠른 벡터 검색에 sqlite-vec 사용
- 프로바이더/모델 변경 시 자동 재인덱싱

## QMD 백엔드 (실험적)

BM25 + 벡터 + 리랭킹을 갖춘 로컬 우선 검색:

```json5
{
  memory: {
    backend: "qmd",
    qmd: {
      includeDefaultMemory: true,
      update: { interval: "5m" }
    }
  }
}
```

## 임베딩 캐시
재임베딩 방지를 위한 청크 임베딩 캐시:

```json5
{
  agents: {
    defaults: {
      memorySearch: {
        cache: { enabled: true, maxEntries: 50000 }
      }
    }
  }
}
```

## 세션 메모리 (실험적)
검색을 위한 세션 기록 인덱싱:

```json5
{
  agents: {
    defaults: {
      memorySearch: {
        experimental: { sessionMemory: true },
        sources: ["memory", "sessions"]
      }
    }
  }
}
```
